{% extends 'main.html' %}
{% load static %}

{% block content %}

<style>
 
/* Gallery Section */
.gallery {
  padding: 20px 0;
  background-color: #f9f9f9;
}

.gallery .gallery-item {
  margin-bottom: 30px;
  overflow: hidden;
  border-radius: 15px;
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
  transition: transform 0.3s ease, box-shadow 0.3s ease, border-radius 0.3s ease;
  position: relative;
  background-color: #fff;
  display: flex;
  flex-direction: column;
  height: 350px; /* Fixed height for the card */
  justify-content: space-between; /* Ensures that the content is spaced properly */
}

.gallery .gallery-item img {
  width: 100%;
  height: 100%; /* Ensure the image fills the height of the card */
  object-fit: cover; /* Ensures the image covers the area without distortion */
  border-radius: 10px; /* Optional: Keeps rounded corners for the images */
  flex-grow: 1; /* Allows the image to take the available space in the card */
}

/* Gallery Item Content */
.gallery .gallery-item .image-name {
  padding: 10px; /* Adds padding for the text area */
  font-size: 1rem;
  font-weight: 600;
  color: #333;
  margin-top: 10px;
  text-transform: capitalize;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  background-color: rgba(255, 255, 255, 0.7); /* Semi-transparent background for better readability */
  text-align: center;
  border-radius: 0 0 15px 15px; /* Rounded bottom corners for the text area */
}

/* Hover effect on gallery items */
.gallery .gallery-item:hover {
  transform: scale(1.05);
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
  border-radius: 20px;
}

/* Customize the GLightbox caption */
.glightbox .gcap {
  font-size: 1.1rem;
  font-weight: 600;
  color: #333;
  text-align: center;
  background-color: rgba(255, 255, 255, 0.7); /* Optional: translucent background for readability */
  padding: 10px;
}


.logo {
  margin-bottom: 10px; /* Reduced bottom margin for the title */
}

/* Modal Button Styling */
.bi-plus {
  background-color: #49b5e7 !important;
  color: white !important;
  padding: 10px;
  border-radius: 50%;
  cursor: pointer;
  transition: background-color 0.3s ease;
  margin-top: -5px; /* Adjusted the top margin to bring the button closer */
}

.bi-plus:hover {
  background-color: #0056b3 !important;
}

/* Responsive Adjustments */
@media (max-width: 767px) {
  .gallery .gallery-item {
    margin-bottom: 20px;
  }

  .gallery .gallery-item img {
    border-radius: 8px; /* Slightly smaller border radius on small screens */
  }

  .gallery .gallery-item .mt-2 {
    font-size: 0.9rem; /* Smaller text on smaller screens */
  }
}

@media (max-width: 575px) {
  .gallery .gallery-item {
    margin-bottom: 15px;
  }

  .gallery .gallery-item .mt-2 {
    font-size: 0.8rem; /* Even smaller text on mobile */
  }
}

</style>
  <main id="main">
    <!-- <h2 class="section-title m-3 text-center">Gallery</h2> -->
    <div class="section-title mt-3">
      <h2>Gallery</h2>
    </div>
    <section class="gallery">
      <div class="container">
        {% if user.is_authenticated and user.role == 'admin' %}
        <div class="d-flex justify-content-center gallery">
          <i data-bs-toggle="modal" data-bs-target="#galleryUpload"
            class="bi bi-plus fs-3 d-flex justify-content-center align-items-center rounded"></i>
        </div>
        {% endif %}
        <div class="row">
          {% for image in data.images %}
          <div class="col-lg-4 col-md-6">
            {% if user.is_authenticated and user.role == 'admin' %}
            <!-- Add Edit and Delete buttons -->
            <div class="d-flex gap-2 mb-2">
              <button type="button" class="btn btn-sm btn-primary" onclick="editImage('{{ image.id }}', '{{ image.title }}', '{{ image.description|escapejs }}')">
                <i class="bi bi-pencil"></i> Edit
              </button>
              <form action="{% url 'delete_image' image.name %}" method="post" style="display: inline;">
                {% csrf_token %}
                <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Delete this image?')">
                  <i class="bi bi-trash"></i> Delete
                </button>
              </form>
            </div>
            {% endif %}
            <div class="gallery-item">
              <a href="{% url 'serve_image' image.name %}" class="glightbox" data-glightbox="image" data-title="{{ image.title|default:image.name }}" data-description="{{ image.description }}">
                <img src="{% url 'serve_image' image.name %}" alt="{{ image.title|default:image.name }}">
              </a>
              {% if image.title or image.description %}
              <div class="image-info" style="padding: 10px; background: white;">
                {% if image.title %}
                <h6 class="mb-1">{{ image.title }}</h6>
                {% endif %}
                {% if image.description %}
                <p class="mb-0 text-muted" style="font-size: 0.85rem;">{{ image.description|truncatewords:15 }}</p>
                {% endif %}
              </div>
              {% endif %}
            </div>
          </div>
        {% endfor %}
        </div>
      </div>
    </section>
  </main>
  


  <!-- modal -->
  <div class="modal fade" id="galleryUpload" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-md">
      <div class="modal-content">
        <form action="{% url 'upload_view' %}" method="POST" enctype="multipart/form-data">
          {% csrf_token %}
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Upload New Image</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="customInputs">
              <div class="row">
                <div class="col-12">
                  <div class="mb-3">
                    <label for="imageTitle" class="form-label">Image Title</label>
                    <input type="text" class="form-control" id="imageTitle" name="title" placeholder="Enter image title">
                  </div>
                  <div class="mb-3">
                    <label for="imageDescription" class="form-label">Description</label>
                    <textarea class="form-control" id="imageDescription" name="description" rows="3" placeholder="Enter image description"></textarea>
                  </div>
                  <div class="mb-3">
                    <label for="formFile" class="form-label">Upload an Image <span class="text-danger">*</span></label>
                    <input class="form-control" type="file" id="formFile" name="image" accept="image/*" required>
                  </div>
                  <div class="preview mt-3">
                    <img id="imagePreview" class="img-thumbnail" style="display: none; max-width: 100%; height: auto;"
                      alt="Image Preview">
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary secondaryBtn" data-bs-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-primary primaryBtn">Submit</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Edit Image Modal -->
  <div class="modal fade" id="editImageModal" tabindex="-1" aria-labelledby="editImageModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-md">
      <div class="modal-content">
        <form id="editImageForm" method="POST">
          {% csrf_token %}
          <div class="modal-header">
            <h5 class="modal-title" id="editImageModalLabel">Edit Image Details</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <input type="hidden" id="editImageId" name="image_id">
            <div class="mb-3">
              <label for="editImageTitle" class="form-label">Image Title</label>
              <input type="text" class="form-control" id="editImageTitle" name="title" placeholder="Enter image title">
            </div>
            <div class="mb-3">
              <label for="editImageDescription" class="form-label">Description</label>
              <textarea class="form-control" id="editImageDescription" name="description" rows="3" placeholder="Enter image description"></textarea>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary secondaryBtn" data-bs-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-primary primaryBtn">Save Changes</button>
          </div>
        </form>
      </div>
    </div>
  </div>

</main>

<!-- Template Main JS File -->
<script src="{% static 'assets/js/main.js' %}"></script>
<script>
  const lightbox = GLightbox({
    selector: '.glightbox'
  });

  function editImage(id, title, description) {
    document.getElementById('editImageId').value = id;
    document.getElementById('editImageTitle').value = title;
    document.getElementById('editImageDescription').value = description;
    document.getElementById('editImageForm').action = `/gallery/edit/${id}/`;
    
    var editModal = new bootstrap.Modal(document.getElementById('editImageModal'));
    editModal.show();
  }
</script>


{% endblock content %}